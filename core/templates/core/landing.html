{% extends "base.html" %}
{% load static %}

{% block title %}{{ title }}{% endblock title %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-12">
            <!-- О проекте -->
            <div class="mb-5" id="about">
                <div class="card shadow-lg border-0 text-light">
                    <div class="card-header text-center py-4">
                        <h1 class="display-4 fw-bold text-primary mb-2">
                            <i class="bi bi-tools me-3"></i>
                            24АвтоСервис
                        </h1>
                        <p class="lead text-white-50 mb-0">
                            Единая площадка для автосервисов, клиентов и поставщиков
                        </p>
                    </div>
                    
                    <div class="card-body p-4">
                        <!-- Основное описание -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h3 class="text-primary mb-3">
                                    <i class="bi bi-info-circle me-2"></i>
                                    О проекте
                                </h3>
                                <p class="text-light fs-5 mb-4">
                                    Наш проект создан для решения задач всех участников автосервисного рынка и помогает объединить на одной площадке:
                                </p>
                            </div>
                        </div>
                        
                        <!-- Участники проекта -->
                        <div class="row g-4 mb-4" id="features">
                            <div class="col-lg-4">
                                <div class="h-100 p-3 bg-dark rounded">
                                    <h5 class="text-primary fw-bold mb-3">
                                        <i class="bi bi-building me-2"></i>
                                        Для автосервисов
                                    </h5>
                                    <ul class="text-light small mb-0">
                                        <li>Простая и быстрая реализация процессов поиска клиентов</li>
                                        <li>Освещение и реклама своих услуг</li>
                                        <li>Управление записями клиентов</li>
                                        <li>Недорогой инструмент для привлечения клиентуры</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <div class="col-lg-4">
                                <div class="h-100 p-3 bg-dark rounded">
                                    <h5 class="text-primary fw-bold mb-3">
                                        <i class="bi bi-person-gear me-2"></i>
                                        Для владельцев авто
                                    </h5>
                                    <ul class="text-light small mb-0">
                                        <li>Поиск автосервисов в своем регионе</li>
                                        <li>Получение информации об услугах</li>
                                        <li>Возможность записи на обслуживание</li>
                                        <li>Оперативная помощь при поломках</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <div class="col-lg-4">
                                <div class="h-100 p-3 bg-dark rounded">
                                    <h5 class="text-primary fw-bold mb-3">
                                        <i class="bi bi-box-seam me-2"></i>
                                        Для поставщиков
                                    </h5>
                                    <ul class="text-light small mb-0">
                                        <li>Расширение рынка реализации продукции</li>
                                        <li>Прямая связь с автосервисами</li>
                                        <li>Реализация коммерческих интересов</li>
                                        <li>Участие в цепочке предоставления услуг</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Особенности проекта -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h4 class="text-primary mb-3">
                                    <i class="bi bi-star-fill me-2"></i>
                                    Особенности проекта
                                </h4>
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <div class="d-flex align-items-start">
                                            <i class="bi bi-check-circle-fill text-success me-3 mt-1"></i>
                                            <div>
                                                <h6 class="text-primary mb-1">Единая площадка</h6>
                                                <p class="text-light small mb-0">
                                                    Объединение потребителей услуг, автосервисов и поставщиков материалов
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-6">
                                        <div class="d-flex align-items-start">
                                            <i class="bi bi-check-circle-fill text-success me-3 mt-1"></i>
                                            <div>
                                                <h6 class="text-primary mb-1">Удобный выбор</h6>
                                                <p class="text-light small mb-0">
                                                    Подбор автосервиса по региону, критериям и отзывам
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-6">
                                        <div class="d-flex align-items-start">
                                            <i class="bi bi-check-circle-fill text-success me-3 mt-1"></i>
                                            <div>
                                                <h6 class="text-primary mb-1">Инструмент для бизнеса</h6>
                                                <p class="text-light small mb-0">
                                                    Доступный механизм привлечения и управления клиентурой
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-6">
                                        <div class="d-flex align-items-start">
                                            <i class="bi bi-check-circle-fill text-success me-3 mt-1"></i>
                                            <div>
                                                <h6 class="text-primary mb-1">Удаленная поддержка</h6>
                                                <p class="text-light small mb-0">
                                                    Блог и чат для оперативного решения проблем
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Дисклеймер -->
                        <div class="row">
                            <div class="col-12">
                                <div class="alert alert-warning text-dark">
                                    <i class="bi bi-exclamation-triangle me-2"></i>
                                    <strong>Важно:</strong> Проект 24АвтоСервис предоставляет площадку для взаимодействия участников, но не несет ответственности за качество оказания услуг. Мы помогаем реализовать потребности всех участников проекта.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Блок выбора автосервиса -->
            <div class="row mb-5" id="autoservice-selection">
                <div class="col-12">
                    <div class="card shadow-lg border-0 text-light">
                        <div class="card-header text-center py-3">
                            <h3 class="text-primary mb-0">
                                <i class="bi bi-search me-2"></i>
                                Выберите автосервис
                            </h3>
                            <p class="text-muted mb-0 mt-2">
                                <small>Регион можно выбрать в меню сверху</small>
                            </p>
                        </div>
                        <div class="card-body p-4">
                            <form id="autoservice-search-form" class="row g-3">
                                <!-- Выбор региона -->
                                <div class="col-md-6">
                                    <label for="region-select" class="form-label text-primary fw-bold">
                                        <i class="bi bi-geo-alt me-2"></i>
                                        Выберите регион:
                                    </label>
                                    <select id="region-select" class="form-select form-select-lg">
                                        <option value="">Все регионы</option>
                                        {% for region in regions %}
                                        <option value="{{ region.id }}">{{ region.name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                
                                <!-- Выбор автосервиса -->
                                <div class="col-md-6">
                                    <label for="autoservice-select" class="form-label text-primary fw-bold">
                                        <i class="bi bi-building me-2"></i>
                                        Выберите автосервис:
                                    </label>
                                    <select id="autoservice-select" class="form-select form-select-lg" disabled>
                                        <option value="">Сначала выберите регион</option>
                                    </select>
                                </div>
                                
                                <!-- Кнопка перехода -->
                                <div class="col-12 text-center">
                                    <button type="submit" class="btn btn-primary btn-lg" id="go-to-autoservice" disabled>
                                        <i class="bi bi-arrow-right me-2"></i>
                                        Перейти к автосервису
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Блок "Хотите стать участником проекта?" - только для неавторизованных -->
                <div class="row mb-5" id="join">
                    <div class="col-12">
                        <div class="card shadow-lg border-0 text-light">
                            <div class="card-header text-center py-3">
                                <h3 class="text-primary mb-0">
                                    <i class="bi bi-people-fill me-2"></i>
                                    Хотите стать участником проекта?
                                </h3>
                            </div>
                            <div class="card-body p-4">
                                <div class="row g-4">
                                    <!-- Для клиентов -->
                                    {% if not user.is_authenticated %}
                                    <div class="col-lg-4">
                                        <div class="h-100 p-4 bg-dark rounded text-center">
                                            <div class="mb-3">
                                                <i class="bi bi-person-check display-4 text-success"></i>
                                            </div>
                                            <h5 class="text-primary fw-bold mb-3">
                                                Для клиентов
                                            </h5>
                                            <p class="text-light mb-4">
                                                Если вы клиент, то просто зарегистрируйтесь на сайте бесплатно, и получите доступ к услугам автосервисов.
                                            </p>
                                            <div class="d-grid">
                                                <a href="{% url 'users:register' %}" class="btn btn-success btn-lg text-white">
                                                    <i class="bi bi-person-plus me-2"></i>
                                                    Зарегистрироваться
                                                </a>
                                            </div>
                                            <div class="mt-3">
                                                <small class="text-white-50">
                                                    <i class="bi bi-gift me-1"></i>
                                                    Бесплатно
                                                </small>
                                            </div>
                                        </div>
                                    </div>
                                    {% endif %}
                                    
                                    <!-- Для автосервисов -->
                                    <div class="col-lg-4">
                                        <div class="h-100 p-4 bg-dark rounded text-center">
                                            <div class="mb-3">
                                                <i class="bi bi-building display-4 text-warning"></i>
                                            </div>
                                            <h5 class="text-primary fw-bold mb-3">
                                                Для автосервисов
                                            </h5>
                                            <p class="text-light mb-4">
                                                Если вы руководитель автосервиса, то зарегистрируйте на сайте свой автосервис и привлекайте новых клиентов.
                                            </p>
                                            <div class="d-grid">
                                                <a href="{% url 'core:autoservice_register' %}" class="btn btn-warning btn-lg">
                                                    <i class="bi bi-building-add me-2"></i>
                                                    Зарегистрировать автосервис
                                                </a>
                                            </div>
                                            <div class="mt-3">
                                                <small class="text-white-50">
                                                    <i class="bi bi-credit-card me-1"></i>
                                                    1 месяц бесплатно,
                                                    далее 5 000 руб./мес.
                                                </small>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Для поставщиков -->
                                    <div class="col-lg-4">
                                        <div class="h-100 p-4 bg-dark rounded text-center">
                                            <div class="mb-3">
                                                <i class="bi bi-box-seam display-4" style="color: #ffd700;"></i>
                                            </div>
                                            <h5 class="text-primary fw-bold mb-3">
                                                Для поставщиков
                                            </h5>
                                            <p class="text-light mb-4">
                                                Если вы магазин автозапчастей, то напишите нам на почту для обсуждения условий сотрудничества.
                                            </p>
                                            <div class="d-grid">
                                                <button class="btn btn-lg text-white disabled" style="background-color: #ffd700; opacity: 0.6;" disabled>
                                                    <i class="bi bi-clock me-2"></i>
                                                    Скоро...
                                                </button>
                                            </div>
                                            <div class="mt-3">
                                                <small class="text-white-50">
                                                    <i class="bi bi-credit-card me-1"></i>
                                                    1 месяц бесплатно,
                                                    далее 5 000 руб./мес.
                                                </small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Дополнительная информация -->
                                <div class="row mt-4">
                                    <div class="col-12">
                                        <div class="text-center p-3 bg-primary bg-opacity-10 rounded">
                                            <h6 class="text-success mb-2">
                                                <i class="bi bi-info-circle me-2"></i>
                                                Присоединяйтесь к нашему проекту!
                                            </h6>
                                            <p class="text-light small mb-0">
                                                Мы стремимся создать удобную экосистему для всех участников автосервисного рынка. 
                                                Вместе мы делаем процесс обслуживания автомобилей проще и доступнее!
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
        </div>
    </div>
</div>

<!-- Стили для hover эффектов -->
<style>
.autoservice-card {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.autoservice-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(0,0,0,0.3) !important;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const regionSelect = document.getElementById('region-select');
    const autoserviceSelect = document.getElementById('autoservice-select');
    const submitButton = document.getElementById('go-to-autoservice');
    const form = document.getElementById('autoservice-search-form');
    
    // Данные автосервисов по регионам
    const autoservicesByRegion = {
        {% for region, autoservices in autoservices_by_region.items %}
        "{{ region.id }}": [
            {% for autoservice in autoservices %}
            {
                "slug": "{{ autoservice.slug }}",
                "name": "{{ autoservice.name }}",
                "address": "{{ autoservice.address|truncatewords:5 }}"
            }{% if not forloop.last %},{% endif %}
            {% endfor %}
        ]{% if not forloop.last %},{% endif %}
        {% endfor %}
    };

    // Функция для получения региона из localStorage
    function getRegionFromStorage() {
        try {
            const regionDataStr = localStorage.getItem('selectedRegion');
            if (!regionDataStr) return null;
            
            const regionData = JSON.parse(regionDataStr);
            
            // Проверяем, не истек ли срок хранения (30 дней)
            if (Date.now() - regionData.timestamp > 30 * 24 * 60 * 60 * 1000) {
                localStorage.removeItem('selectedRegion');
                return null;
            }
            
            return regionData;
        } catch (error) {
            localStorage.removeItem('selectedRegion');
            return null;
        }
    }

    // Функция для обновления интерфейса при смене региона
    window.updateRegionInInterface = function(regionId, regionName) {
        // Обновляем выбранный регион в селекте
        regionSelect.value = regionId;
        
        // Обновляем список автосервисов
        updateAutoservicesList(regionId);
    };

    // Функция для обновления списка автосервисов
    function updateAutoservicesList(regionId) {
        // Очищаем список автосервисов
        autoserviceSelect.innerHTML = '';
        autoserviceSelect.disabled = true;
        submitButton.disabled = true;
        
        if (regionId && regionId != '0') {
            const autoservices = autoservicesByRegion[regionId] || [];
            
            if (autoservices.length > 0) {
                // Добавляем опцию по умолчанию
                const defaultOption = document.createElement('option');
                defaultOption.value = '';
                defaultOption.textContent = 'Выберите автосервис';
                autoserviceSelect.appendChild(defaultOption);
                
                // Добавляем автосервисы
                autoservices.forEach(function(autoservice) {
                    const option = document.createElement('option');
                    option.value = autoservice.slug;
                    option.textContent = autoservice.name + ' - ' + autoservice.address;
                    autoserviceSelect.appendChild(option);
                });
                
                autoserviceSelect.disabled = false;
            } else {
                const noOption = document.createElement('option');
                noOption.value = '';
                noOption.textContent = 'Нет доступных автосервисов';
                autoserviceSelect.appendChild(noOption);
            }
        } else {
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = 'Сначала выберите регион';
            autoserviceSelect.appendChild(defaultOption);
        }
    }

    // Инициализация с сохранённым регионом
    const savedRegion = getRegionFromStorage();
    if (savedRegion && savedRegion.id && savedRegion.id != '0') {
        updateRegionInInterface(savedRegion.id, savedRegion.name);
    }

    // Обработчик изменения региона
    regionSelect.addEventListener('change', function() {
        const regionId = this.value;
        updateAutoservicesList(regionId);
        
        // Сохраняем выбор в localStorage
        if (regionId) {
            const regionName = this.options[this.selectedIndex].text;
            const regionData = {
                id: regionId,
                name: regionName,
                timestamp: Date.now()
            };
            localStorage.setItem('selectedRegion', JSON.stringify(regionData));
        }
    });
    
    // Обработчик изменения автосервиса
    autoserviceSelect.addEventListener('change', function() {
        submitButton.disabled = !this.value;
    });
    
    // Обработчик отправки формы
    form.addEventListener('submit', function(e) {
        e.preventDefault();
        const autoserviceSlug = autoserviceSelect.value;
        if (autoserviceSlug) {
            window.location.href = `/autoservice/${autoserviceSlug}/`;
        }
    });
});
</script>
{% endblock content %}